// ______________________________________________________
// Generated by sql2java - https://github.com/10km/sql2java-2-6-7 (custom branch) 
// modified by guyadong from
// sql2java original version https://sourceforge.net/projects/sql2java/ 
// jdbc driver used at code generation time: com.mysql.jdbc.Driver
// template: foreign.key.listener.java.vm
// ______________________________________________________
package net.gdface.facelog.dborm;

import java.util.List;
import net.gdface.facelog.dborm.exception.DAOException;

/**
 * abstract implementation of foreign key listener for DEELTE RULE
 * @author guyadong
 *
 * @param <FB> bean for foreign table 
 * @param <B> bean for self table
 */
public abstract class ForeignKeyListener<FB extends BaseBean<FB>,B extends BaseBean<B>> extends TableListener.Adapter<FB>{
    protected ForeignKeyListener(){}
    protected abstract List<B> getImportedBeans(FB fb) throws DAOException;
    protected abstract void onRemove(List<B> effectBeans) throws DAOException;
    protected final InheritableThreadLocal<List<B>> importedBeans = new InheritableThreadLocal<List<B>>();
    @Override
    public void beforeDelete(FB bean) throws DAOException{
        this.importedBeans.set(getImportedBeans(bean));
    }

    @Override
    public void afterDelete(FB bean) throws DAOException{
        try{
            List<B> beans = this.importedBeans.get();
            if(null != beans){
                onRemove(beans);
            }
        }finally{
            importedBeans.set(null);
        }
    }
}

