// ______________________________________________________
// Generated by sql2java - https://github.com/10km/sql2java-2-6-7 (custom branch) 
// modified by guyadong from
// sql2java original version https://sourceforge.net/projects/sql2java/ 
// JDBC driver used at code generation time: com.mysql.jdbc.Driver
// template: cmd.java.vm
// ______________________________________________________

package net.gdface.facelog.client;

import java.lang.reflect.Type;
import java.net.URL;
import java.util.List;
import java.util.Map;

import com.alibaba.fastjson.parser.ParserConfig;
import com.alibaba.fastjson.util.TypeUtils;
import com.google.common.collect.ImmutableMap;
import com.google.common.reflect.TypeToken;

/** 
 * 设备命令定义 
 * @author guyadong
 */
public enum Cmd{
    /** 设置参数,可用于运行时修改参数 */
    parameter,
    /** 设置一组参数,可用于需要重启有效的参数 */
    config,
    /** 读取设备状态参数 */
    status,
    /** 设备状态报告,返回一组状态参数 */
    report,
    /** 获取设备版本号 */
    version,
    /** 设置设备工作状态 */
    enable,
    /** 返回设备工作状态 */
    isEnable,
    /** 设备重启 */
    reset,
    /** 设备与服务器时间同步 */
    time,
    /** 更新版本 */
    update,
    /** 设置空闲时显示的消息 */
    idleMessage,
    /** 为指定人员通过时显示的临时消息 */
    personMessage,
    /** 自定义命令,命令名及命令参数类型由应用项目自定义,因为Map中没有定义每一个自定义命令参数的类型,设备端需要自行将命令参数转为项目约定的参数类型,参见{@link Cmd#cast(Object,Type)} */
    custom;
    
    /**
     * 对{@code adapter}执行当前设备命令
     * @param adapter 命令执行对象
     * @param parameters
     * @return 包含命令执行结果的命令响应对象
     */
    @SuppressWarnings("serial")
    public Ack<?> run(CommandAdapter adapter,Map<String,? extends Object> parameters){
        if(null == parameters){
            parameters = ImmutableMap.of();
        }
        switch(this){
        case parameter:{
                Ack<Void> ack = new Ack<Void>().setStatus(Ack.Status.OK);
                try{
                    adapter.parameter(
                            cast(parameters.get("key"),new TypeToken<String>(){}),
                            cast(parameters.get("value"),new TypeToken<String>(){}));
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case config:{
                Ack<Void> ack = new Ack<Void>().setStatus(Ack.Status.OK);
                try{
                    adapter.config(
                            cast(parameters.get("properties"),new TypeToken<Map<String,String>>(){}));
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case status:{
                Ack<Object> ack = new Ack<Object>().setStatus(Ack.Status.OK);
                try{
                    Object res = adapter.status(
                            cast(parameters.get("name"),new TypeToken<String>(){}));
                    // 填入返回值
                    ack.setValue(res);
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case report:{
                Ack<Map<String,Object>> ack = new Ack<Map<String,Object>>().setStatus(Ack.Status.OK);
                try{
                    Map<String,Object> res = adapter.report(
                            cast(parameters.get("names"),new TypeToken<List<String>>(){}));
                    // 填入返回值
                    ack.setValue(res);
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case version:{
                Ack<String> ack = new Ack<String>().setStatus(Ack.Status.OK);
                try{
                    String res = adapter.version();
                    // 填入返回值
                    ack.setValue(res);
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case enable:{
                Ack<Void> ack = new Ack<Void>().setStatus(Ack.Status.OK);
                try{
                    adapter.enable(
                            cast(parameters.get("enable"),new TypeToken<Boolean>(){}));
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case isEnable:{
                Ack<Boolean> ack = new Ack<Boolean>().setStatus(Ack.Status.OK);
                try{
                    Boolean res = adapter.isEnable(
                            cast(parameters.get("message"),new TypeToken<String>(){}));
                    // 填入返回值
                    ack.setValue(res);
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case reset:{
                Ack<Void> ack = new Ack<Void>().setStatus(Ack.Status.OK);
                try{
                    adapter.reset(
                            cast(parameters.get("schedule"),new TypeToken<Long>(){}));
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case time:{
                Ack<Void> ack = new Ack<Void>().setStatus(Ack.Status.OK);
                try{
                    adapter.time(
                            cast(parameters.get("unixTimestamp"),new TypeToken<Long>(){}));
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case update:{
                Ack<Void> ack = new Ack<Void>().setStatus(Ack.Status.OK);
                try{
                    adapter.update(
                            cast(parameters.get("url"),new TypeToken<URL>(){}),
                            cast(parameters.get("version"),new TypeToken<String>(){}),
                            cast(parameters.get("schedule"),new TypeToken<Long>(){}));
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case idleMessage:{
                Ack<Void> ack = new Ack<Void>().setStatus(Ack.Status.OK);
                try{
                    adapter.idleMessage(
                            cast(parameters.get("message"),new TypeToken<String>(){}),
                            cast(parameters.get("duration"),new TypeToken<Long>(){}));
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case personMessage:{
                Ack<Void> ack = new Ack<Void>().setStatus(Ack.Status.OK);
                try{
                    adapter.personMessage(
                            cast(parameters.get("message"),new TypeToken<String>(){}),
                            cast(parameters.get("id"),new TypeToken<Integer>(){}),
                            cast(parameters.get("group"),new TypeToken<Boolean>(){}),
                            cast(parameters.get("onceOnly"),new TypeToken<Boolean>(){}),
                            cast(parameters.get("duration"),new TypeToken<Long>(){}));
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        case custom:{
                Ack<Object> ack = new Ack<Object>().setStatus(Ack.Status.OK);
                try{
                    Object res = adapter.custom(
                            cast(parameters.get("cmdName"),new TypeToken<String>(){}),
                            cast(parameters.get("parameters"),new TypeToken<Map<String,Object>>(){}));
                    // 填入返回值
                    ack.setValue(res);
                }catch(CommandAdapter.UnsupportCmdExeption e){
                    // 该命令设备端未实现
                    ack.setStatus(Ack.Status.UNSUPPORTED);
                }catch(CommandAdapter.DeviceCmdException e){
                    // 填入异常状态,设置错误信息
                    ack.setStatus(Ack.Status.ERROR).setErrorMessage(e.getMessage());
                }                
                return ack;
            }
        default:
            // dead code 不会执行到这里
            throw new IllegalArgumentException();
        }
    }
    /**
     * 将{@code value}转为{@code typeToken}指定的类型
     * @param <T> 目标参数类型
     * @param value
     * @param typeToken
     * @return
     * @see #cast(Object, Type)
     */
    public static final <T> T cast(Object value,TypeToken<T> typeToken){
        return cast(value,typeToken.getType());
    }
    /**
     * 将{@code value}转为{@code type}指定的类型
     * @param <T> 目标参数类型
     * @param value
     * @param type
     * @return
     * @see TypeUtils#cast(Object, Type, ParserConfig)
     */
    @SuppressWarnings("unchecked")
    public static final <T> T cast(Object value,Type type){
        return (T)TypeUtils.cast(value,type,ParserConfig.getGlobalInstance());
    }
    /**
     * 将{@code value}转为{@code clazz}指定的类型
     * @param <T> 目标参数类型
     * @param value
     * @param clazz
     * @return
     * @see TypeUtils#cast(Object, Class, ParserConfig)
     */
    public static final <T> T cast(Object value,Class<T> clazz){
        return TypeUtils.cast(value,clazz,ParserConfig.getGlobalInstance());
    }
}
